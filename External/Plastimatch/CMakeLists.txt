if(USE_DCMTK)  
  set(PLM_SYSTEM_DCMTK YES CACHE STRING)
  message(STATUS "test: ${DCMTK_BINARY_DIR}")
  if(NOT USE_SYSTEM_DCMTK)
    set(DCMTK_DIR "${DCMTK_BINARY_DIR}/../" CACHE PATH)
  endif()
  set(PLM_CONFIG_ENABLE_SUPERBUILD OFF CACHE BOOL)
else()
  # Plastimatch will handle DCMTK by itself this way
  set(PLM_SYSTEM_DCMTK PREFERRED CACHE STRING)
  set(PLM_CONFIG_ENABLE_DCMTK CACHE BOOL ON)

  find_package(ITK REQUIRED COMPONENTS ITKDCMTK)
  set(DCMTK_FOUND CACHE BOOL ON)

  # However, plm currently uses suberbuild to do so:
  set(PLM_CONFIG_ENABLE_SUPERBUILD OFF CACHE BOOL)
endif()

set(PLM_SYSTEM_ITK YES CACHE STRING)
if(NOT USE_SYSTEM_ITK)
  set(ITK_DIR "${ITK_BINARY_DIR}" CACHE PATH)
endif()

set(PLM_BUILD_TESTING ${BUILD_TESTING} CACHE BOOL "")
set(PLM_CONFIG_DISABLE_REG23 ON CACHE BOOL)
set(PLM_CONFIG_CLANG_COMPLETE ON CACHE BOOL) # Just for my amusement

# OpenCL
if(OpenCL_FOUND)
  set(PLM_CONFIG_DISABLE_OPENCL OFF CACHE BOOL)
else(OpenCL_FOUND)
  set(PLM_CONFIG_DISABLE_OPENCL ON CACHE BOOL)
endif(OpenCL_FOUND)
set(OPENCL_INCLUDE_DIRS ${OpenCL_INCLUDE_DIR} CACHE PATH)
set(OPENCL_LIBRARIES ${OpenCL_LIBRARY} CACHE FILEPATH)

# OpenMP
message(STATUS "Found omp: ${OpenMP_CXX_FOUND}, flags: ${OpenMP_CXX_FLAGS}, libs: ${OpenMP_CXX_LIBRARIES}.")
set(PLM_CONFIG_ENABLE_OPENMP ${OpenMP_CXX_FOUND} CACHE BOOL)
set(OPENMP_FLAGS ${OpenMP_CXX_FLAGS} CACHE STRING)
set(OPENMP_LIBRARIES ${OpenMP_CXX_LIBRARIES} CACHE STRING)

# CUDA
if(USE_CUDA)
  set(PLM_CONFIG_DISABLE_CUDA OFF CACHE BOOL)
  set(PLM_CONFIG_ENABLE_CUDA ON CACHE BOOL)
else()
  set(PLM_CONFIG_DISABLE_CUDA ON CACHE BOOL)
  set(PLM_CONFIG_ENABLE_CUDA OFF CACHE BOOL)
endif()
set(PLM_CUDA_ALL_DEVICES ON CACHE BOOL)
set(CUDA_SEPARABLE_COMPILATION OFF CACHE BOOL)
set(PLM_CONFIG_LEGACY_CUDA_DELAYLOAD OFF CACHE BOOL)

# FFTW
set(FFTW_DIR ${FFTW_INCLUDE_DIR} CACHE PATH)

# dlib
if(NOT USE_SYSTEM_DLIB)
  set(PLM_PREFER_SYSTEM_DLIB ON CACHE PATH)
  set(dlib_DIR ${DLIB_BINARY_DIR} CACHE PATH)
endif()

set_directory_properties(PROPERTIES EXCLUDE_FROM_ALL YES)
FetchContent_MakeAvailable(Plastimatch)
